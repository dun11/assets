<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Content management</title>
    <link rel="icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/gdtool/zhaopp/cfblog/favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/gdtool/zhaopp/cfblog/favicon.ico"/>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/editor.md@1.5.0/css/editormd.css" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/bootstrap-select/1.9.4/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

    <script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-zh_CN.min.js"></script>


</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div>
            <ul id="myTab" class="nav nav-tabs">
                <li>
                    <a href="/">CF-blog</a>
                </li>
                <li>
                    <a href="#list" data-toggle="tab">我的文章</a>
                </li>
                <li class="active">
                    <a href="#new" data-toggle="tab">新建</a>
                </li>
                <li>
                    <a href="#config" data-toggle="tab">设置</a>
                </li>
                <li>
                    <a href="#" data-toggle="tab" onclick="publish()">发布</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="myTabContent" class="tab-content" style="padding-top: 60px;">
    <div class="tab-pane fade" id="list">
        <div class="container">
            <table class="table table-striped" id="articleList">
                <tr><td>ID</td><td>标题</td><td>创建日期</td></tr>
            </table>
            <input type="hidden" name="page" id="page" value='1'>
            <a id="loadmore" class="btn btn-default">加载更多...</a>
        </div>
    </div>
    <div class="tab-pane fade in active" id="new">
        <div class="container">
            <h3 id="labelNew">新增</h3>
            <form id="addNewForm" class="form-inline">
                <div class="form-group" style="width: 98%">
                    <input type="hidden" class="form-control" name="id" id="id">
                    <input type="text" class="form-control" name="title" id="title" placeholder="标题" style="width: 100%;" required="required">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" name="permalink" id="permalink" placeholder="永久链接" required="required">
                </div>
                <div class="form-group">
                    <select id="category" class="selectpicker" data-live-search="true">
                        <option value="">选择分类</option>
                        <option value="1">分类1</option>
                        <option value="2">分类2</option>
                    </select>
                </div>
                <div class="form-group">
                    <select id="tag" class="selectpicker" multiple data-live-search="true">
                        <option value="1">标签1</option>
                        <option value="2">标签2</option>
                        <option value="3">标签3</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">保存</button>
            </form>
        </div>
    </div>
    <div class="tab-pane fade" id="config">
        <div class="container">
            <h3>分类和菜单设置</h3>
            <form id="configForm" class="form-inline">
                <div class="form-group">
                    <label for="menu">菜单：</label>
                    <textarea id="menu" class="form-control" rows="5" style="width: 100%;"></textarea>
                </div>
                <div class="form-group">
                    <label for="categoryConfig">分类：</label>
                    <textarea id="categoryConfig" class="form-control" rows="5" style="width: 100%;"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">保存设置</button>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // 页面加载完成后执行的操作
        loadArticles();

        // 加载更多按钮点击事件
        $("#loadmore").click(function() {
            var page = $("#page").val();
            page = parseInt(page) + 1;
            $("#page").val(page);
            loadArticles();
        });

        // 提交新文章表单
        $("#addNewForm").submit(function(e) {
            e.preventDefault();
            saveArticle();
        });

        // 提交设置表单
        $("#configForm").submit(function(e) {
            e.preventDefault();
            saveConfig();
        });
    });

    // 加载文章列表
    function loadArticles() {
        var page = $("#page").val();
        $.ajax({
            url: "/articles?page=" + page,
            type: "GET",
            dataType: "json",
            success: function(response) {
                if (response.code == 200) {
                    var articles = response.data.articles;
                    var table = $("#articleList");
                    for (var i = 0; i < articles.length; i++) {
                        var article = articles[i];
                        var row = "<tr><td>" + article.id + "</td><td>" + article.title + "</td><td>" + article.create_date + "</td></tr>";
                        table.append(row);
                    }
                    if (articles.length < response.data.page_size) {
                        $("#loadmore").hide();
                    }
                } else {
                    alert("加载文章列表失败");
                }
            },
            error: function() {
                alert("加载文章列表失败");
            }
        });
    }

    // 保存文章
    function saveArticle() {
        var id = $("#id").val();
        var title = $("#title").val();
        var permalink = $("#permalink").val();
        var category = $("#category").val();
        var tags = $("#tag").val();

        var data = {
            id: id,
            title: title,
            permalink: permalink,
            category: category,
            tags: tags
        };

        $.ajax({
            url: "/save",
            type: "POST",
            data: JSON.stringify(data),
            contentType: "application/json",
            success: function(response) {
                if (response.code == 200) {
                    alert("保存成功");
                    $("#id").val("");
                    $("#title").val("");
                    $("#permalink").val("");
                    $("#category").val("");
                    $("#category").selectpicker("refresh");
                    $("#tag").val("");
                    $("#tag").selectpicker("refresh");
                } else {
                    alert("保存失败");
                }
            },
            error: function() {
                alert("保存失败");
            }
        });
    }

    // 保存设置
    function saveConfig() {
        var menu = $("#menu").val();
        var categoryConfig = $("#categoryConfig").val();

        var data = {
            menu: menu,
            categoryConfig: categoryConfig
        };

        $.ajax({
            url: "/config/save",
            type: "POST",
            data: JSON.stringify(data),
            contentType: "application/json",
            success: function(response) {
                if (response.code == 200) {
                    alert("保存成功");
                } else {
                    alert("保存失败");
                }
            },
            error: function() {
                alert("保存失败");
            }
        });
    }

    // 发布文章
    function publish() {
        alert("发布文章");
    }
</script>

</body>
</html>
