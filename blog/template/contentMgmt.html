<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>CF-blog后台</title>
	<link rel="icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/gdtool/zhaopp/cfblog/favicon.ico">
	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/editor.md@1.5.0/css/editormd.css">
	<link rel="stylesheet" href="https://cdn.staticfile.org/bootstrap-select/1.9.4/css/bootstrap-select.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<ul id="myTab" class="nav nav-tabs">
				<li><a href="/">CF-blog</a></li>
				<li><a href="#list" data-toggle="tab">我的文章</a></li>
				<li class="active"><a href="#new" data-toggle="tab">新建</a></li>
				<li><a href="#config" data-toggle="tab">设置</a></li>
				<li><a href="#" data-toggle="tab" onclick="publish()">发布</a></li>
			</ul>
		</div>
	</nav>
	<div id="myTabContent" class="tab-content" style="padding-top: 60px;">
		<div class="tab-pane fade" id="list">
			<div class="container">
				<table class="table table-striped" id="articleList">
					<tr>
						<td>ID</td>
						<td>标题</td>
						<td>创建日期</td>
					</tr>
				</table>
				<input type="hidden" name="page" id="page" value="1">
				<a id="loadmore" class="btn btn-default">加载更多...</a>
			</div>
		</div>
		<div class="tab-pane fade in active" id="new">
			<div class="container">
				<h3 id="labelNew">新增</h3>
				<form id="addNewForm" class="form-inline">
					<div class="form-group" style="width: 98%">
						<input type="hidden" class="form-control" name="id" id="id">
						<input type="text" class="form-control" name="title" id="title" placeholder="标题" style="width: 100%;" required>
					</div>
					<div class="form-group">
						<label for="exampleInputEmail2">特色图片</label>
						<input type="url" class="form-control" style="width: 400px;" name="img" id="img" placeholder="">
					</div>
					<div class="form-group">
						<label for="exampleInputEmail2">永久链接</label>
						<input type="text" class="form-control" name="link" id="link" placeholder="" required>
					</div>
					<div class="form-group">
						<label for="exampleInputEmail2">创建日期</label>
						<input type="datetime-local" class="form-control" id="createDate" name="createDate" placeholder="" required>
					</div>
					<br>
					<br>
					<textarea id="editormd" name="content" style="width: 100%; height: 500px;"></textarea>
				</form>
			</div>
		</div>
		<div class="tab-pane fade" id="config">
			<div class="container">
				<h3>设置</h3>
				<form class="form-horizontal">
					<div class="form-group">
						<label for="inputAuthor" class="col-sm-2 control-label">作者</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="inputAuthor" placeholder="作者">
						</div>
					</div>
					<div class="form-group">
						<label for="inputKeywords" class="col-sm-2 control-label">关键词</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="inputKeywords" placeholder="关键词">
						</div>
					</div>
					<div class="form-group">
						<label for="inputDescription" class="col-sm-2 control-label">描述</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="inputDescription" placeholder="描述">
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/editor.md@1.5.0/lib/"></script>
	<script src="https://cdn.staticfile.org/bootstrap-select/1.9.4/js/bootstrap-select.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
	<script>
		$(document).ready(function() {
			loadArticles();
		});

		function loadArticles() {
			var page = $('#page').val();
			$.ajax({
				url: '/api/articles',
				method: 'GET',
				data: {
					page: page
				},
				success: function(response) {
					if (response.status === 'success') {
						var articles = response.data;
						for (var i = 0; i < articles.length; i++) {
							var article = articles[i];
							var row = '<tr>';
							row += '<td>' + article.id + '</td>';
							row += '<td>' + article.title + '</td>';
							row += '<td>' + article.createDate + '</td>';
							row += '</tr>';
							$('#articleList').append(row);
						}
						if (articles.length === 10) {
							$('#loadmore').show();
						} else {
							$('#loadmore').hide();
						}
					}
				}
			});
		}

		function publish() {
			// 发布文章逻辑
		}

		$('#loadmore').click(function() {
			var page = parseInt($('#page').val()) + 1;
			$('#page').val(page);
			loadArticles();
		});

		// 初始化编辑器
		var editor = editormd("editormd", {
			width: "100%",
			height: 500,
			path: "https://cdn.jsdelivr.net/npm/editor.md/lib/",
			imageUpload: true,
			imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
			imageUploadURL: "./php/upload.php",
			saveHTMLToTextarea: true
		});
	</script>
</body>
</html>
